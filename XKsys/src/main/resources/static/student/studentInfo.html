<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>学生信息</title>
    <link rel="stylesheet" href="/layui/css/layui.css">
</head>
<body>
<div class="layui-container" style="margin-top: 50px;">
    <form class="layui-form" id="studentForm">
        <div class="layui-form-item">
            <label class="layui-form-label">学生ID</label>
            <div class="layui-input-block">
                <input type="text" name="studentid" id="studentId" readonly class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">学生姓名</label>
            <div class="layui-input-block">
                <input type="text" name="studentname" id="studentNameEdit" required lay-verify="required"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">学生学号</label>
            <div class="layui-input-block">
                <input type="text" name="studentno" id="studentNoEdit" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">密码</label>
            <div class="layui-input-block">
                <input type="password" name="studentpwd" id="studentPwdEdit" required lay-verify="required"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">邮件</label>
            <div class="layui-input-block">
                <input type="email" name="email" id="studentEmailEdit" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">专业</label>
            <div class="layui-input-block">
                <input type="text" name="major" id="studentMajorEdit" required lay-verify="required" autocomplete="off"
                       class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <label class="layui-form-label">年级</label>
            <div class="layui-input-block">
                <input type="text" name="grade" id="studentGradeEdit" required lay-verify="required"
                       autocomplete="off" class="layui-input">
            </div>
        </div>
        <div class="layui-form-item">
            <div class="layui-input-block">
                <button class="layui-btn" lay-submit lay-filter="editStudent">编辑</button>
            </div>
        </div>
    </form>
</div>


<!--编辑窗口组件-->
<div id="editWin" lay-filter="editWin" class="layui-form" style="display: none; padding: 20px;">
    <input type="hidden" name="studentid">

    <!-- 使用 layui-inline 包裹每个表单项 -->
    <div class="layui-form-item layui-inline">
        <label class="layui-form-label"><i class="layui-icon layui-icon-username"></i> 学生姓名</label>
        <div class="layui-input-inline">
            <input type="text" name="studentname" placeholder="请输入学生姓名" autocomplete="off" class="layui-input"
                   lay-verify="required">
        </div>
    </div>

    <div class="layui-form-item layui-inline">
        <label class="layui-form-label"><i class="layui-icon layui-icon-user"></i> 学生学号</label>
        <div class="layui-input-inline">
            <input type="text" name="studentno" placeholder="请输入学生学号" autocomplete="off" class="layui-input"
                   lay-verify="required">
        </div>
    </div>

    <div class="layui-form-item layui-inline">
        <label class="layui-form-label"><i class="layui-icon layui-icon-email"></i> 学生邮箱</label>
        <div class="layui-input-inline">
            <input type="email" name="email" placeholder="请输入学生邮箱" autocomplete="off" class="layui-input"
                   lay-verify="email">
        </div>
    </div>

    <div class="layui-form-item layui-inline">
        <label class="layui-form-label"><i class="layui-icon layui-icon-note"></i> 学生专业</label>
        <div class="layui-input-inline">
            <input type="text" name="major" placeholder="请输入学生专业" autocomplete="off" class="layui-input"
                   lay-verify="required">
        </div>
    </div>

    <div class="layui-form-item layui-inline">
        <label class="layui-form-label"><i class="layui-icon layui-icon-female"></i> 学生性别</label>
        <div class="layui-input-inline">
            <select name="grade" lay-verify="required">
                <option value="">请选择性别</option>
                <option value="男">男</option>
                <option value="女">女</option>
            </select>
        </div>
    </div>
</div>
<script src="/layui/layui.all.js"></script>
<script>
    /*声明layui内部对象*/
    const $ = layui.$;
    const form = layui.form;
    const layer = layui.layer;
    var baseUrl = "http://localhost:8080/student/";

    // 获取当前登录学生的信息
    function getStudentInfo() {
        $.ajax({
            url:baseUrl + "getinfo",
            method: "GET",
            success: function (result) {
                if (result) {
                    $("#studentId").val(result.studentid);
                    $("#studentNameEdit").val(result.studentname);
                    $("#studentNoEdit").val(result.studentno);
                    $("#studentPwdEdit").val(result.studentpwd);
                    $("#studentEmailEdit").val(result.email);
                    $("#studentMajorEdit").val(result.major);
                    $("#studentGradeEdit").val(result.grade);
                } else {
                    // 如果后端返回的格式不符合预期，提供更具体的错误信息
                    layer.msg("获取学生信息失败: " + (result.message || '未知错误'), {icon: 2, time: 1800});
                }
            },
            error: function (jqXHR, textStatus, errorThrown) {
                // 记录详细的错误信息到控制台
                console.error("获取学生信息失败: " + textStatus + ", " + errorThrown);
                // 提供用户友好的错误提示
                layer.msg("获取学生信息失败: " + (jqXHR.responseText || '网络错误'), {icon: 2, time: 1800});
            }
        });
    }

    // 提交修改
    form.on('submit(editStudent)', function (data) {
        $.ajax({
            url: baseUrl + "edit",
            method: "post",
            data: data.field,
            success: function (result) {
                //修改成功，数据库同步成功，但是result.success返回false
                if (result.success) {
                    layer.msg("修改成功", {icon: 1, time: 1800});
                } else {
                    layer.msg("修改失败：" + result.message, {icon: 2, time: 1800});
                }
            },
            error: function () {
                layer.msg("修改失败", {icon: 2, time: 1800});
            }
        });
        return false; // 阻止表单跳转
    });

    // 页面加载时获取学生信息
    $(document).ready(function () {
        getStudentInfo();
    });
</script>
</body>
</html>
