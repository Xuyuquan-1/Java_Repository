<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>学生信息</title>
    <style>
        /* 全局样式 */
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f4f4f4;
        }

        /* 弹窗样式 */
        .modal {
            display: none;
            position: fixed;
            z-index: 1;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto;
            background-color: rgba(0, 0, 0, 0.4);
        }

        .modal-content {
            background-color: white;
            margin: 10% auto;
            padding: 20px;
            border: 1px solid #888;
            width: 600px;
            max-width: 90%;
            border-radius: 5px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .modal-header, .modal-footer {
            text-align: center;
        }

        .modal-header h2 {
            margin: 0;
        }

        .modal-body .form-group {
            display: flex;
            align-items: center;
            margin-bottom: 15px;
        }

        .modal-body label {
            flex: 1;
            margin-right: 10px;
            font-weight: bold;
        }

        .modal-body input[type="text"],
        .modal-body input[type="email"],
        .modal-body input[type="password"] {
            flex: 2;
            padding: 8px;
            box-sizing: border-box;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .modal-footer button {
            padding: 8px 12px;
            margin: 5px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
        }

        .modal-footer .btn-primary {
            background-color: #007bff;
            color: white;
        }

        .modal-footer .btn-secondary {
            background-color: #6c757d;
            color: white;
        }

        .modal-footer button:hover {
            opacity: 0.9;
        }

        /* 加载动画 */
        .loading {
            display: none;
            position: fixed;
            z-index: 2;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.4);
            justify-content: center;
            align-items: center;
        }

        .loading::after {
            content: '';
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 2s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</head>
<body>

<!-- 学生信息弹窗 -->
<div id="studentInfoModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>学生信息</h2>
        </div>
        <div class="modal-body">
            <p><strong>学生ID：</strong><span id="studentId"></span></p>
            <p><strong>学生姓名：</strong><span id="studentName"></span></p>
            <p><strong>学生学号：</strong><span id="studentNo"></span></p>
            <p><strong>密码：</strong><span id="studentPwd"></span></p>
            <p><strong>邮件：</strong><span id="studentEmail"></span></p>
            <p><strong>专业：</strong><span id="studentMajor"></span></p>
            <p><strong>性别：</strong><span id="studentGender"></span></p>
        </div>
        <div class="modal-footer">
            <button class="btn-primary" id="editBtn">编辑</button>
        </div>
    </div>
</div>

<!-- 编辑窗口组件 -->
<div id="editModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2>编辑学生信息</h2>
        </div>
        <div class="modal-body">
            <input type="hidden" id="studentIdEdit">
            <div class="form-group">
                <label for="studentNameEdit">学生姓名</label>
                <input type="text" id="studentNameEdit" required>
            </div>
            <div class="form-group">
                <label for="studentNoEdit">学生学号</label>
                <input type="text" id="studentNoEdit" required>
            </div>
            <div class="form-group">
                <label for="studentPwdEdit">密码</label>
                <input type="password" id="studentPwdEdit" required>
            </div>
            <div class="form-group">
                <label for="studentEmailEdit">邮件</label>
                <input type="email" id="studentEmailEdit" required>
            </div>
            <div class="form-group">
                <label for="studentMajorEdit">专业</label>
                <input type="text" id="studentMajorEdit" required>
            </div>
            <div class="form-group">
                <label for="studentGenderEdit">性别</label>
                <input type="text" id="studentGenderEdit" required>
            </div>
        </div>
        <div class="modal-footer">
            <button class="btn-primary" id="saveBtn">保存</button>
            <button class="btn-secondary" id="cancelBtn">取消</button>
        </div>
    </div>
</div>

<!-- 加载动画 -->
<div id="loading" class="loading"></div>

<script>
    // 显示加载动画
    function showLoading() {
        document.getElementById('loading').style.display = 'flex';
    }

    // 隐藏加载动画
    function hideLoading() {
        document.getElementById('loading').style.display = 'none';
    }

    // 显示学生信息弹窗
    function showStudentInfo(studentData) {
        document.getElementById('studentId').innerText = studentData.studentid;
        document.getElementById('studentName').innerText = studentData.studentname;
        document.getElementById('studentNo').innerText = studentData.studentno;
        document.getElementById('studentPwd').innerText = studentData.studentpwd;
        document.getElementById('studentEmail').innerText = studentData.email;
        document.getElementById('studentMajor').innerText = studentData.major;
        document.getElementById('studentGender').innerText = studentData.gender;

        const modal = document.getElementById('studentInfoModal');
        modal.style.display = 'block';
    }

    // 打开编辑窗口
    document.getElementById('editBtn').addEventListener('click', () => {
        const editModal = document.getElementById('editModal');
        editModal.style.display = 'block';

        // 填充编辑窗口的数据
        document.getElementById('studentIdEdit').value = studentData.studentid;
        document.getElementById('studentNameEdit').value = studentData.studentname;
        document.getElementById('studentNoEdit').value = studentData.studentno;
        document.getElementById('studentPwdEdit').value = studentData.studentpwd;
        document.getElementById('studentEmailEdit').value = studentData.email;
        document.getElementById('studentMajorEdit').value = studentData.major;
        document.getElementById('studentGenderEdit').value = studentData.gender;
    });

    // 保存编辑的学生信息
    document.getElementById('saveBtn').addEventListener('click', () => {
        const studentId = document.getElementById('studentIdEdit').value;
        const studentName = document.getElementById('studentNameEdit').value;
        const studentNo = document.getElementById('studentNoEdit').value;
        const studentPwd = document.getElementById('studentPwdEdit').value;
        const studentEmail = document.getElementById('studentEmailEdit').value;
        const studentMajor = document.getElementById('studentMajorEdit').value;
        const studentGender = document.getElementById('studentGenderEdit').value;

        const formData = {
            studentid: studentId,
            studentname: studentName,
            studentno: studentNo,
            studentpwd: studentPwd,
            email: studentEmail,
            major: studentMajor,
            gender: studentGender
        };

        // 显示加载动画
        showLoading();

        fetch('/student/edit', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json'
            },
            body: JSON.stringify(formData)
        })
            .then(response => response.json())
            .then(result => {
                if (result.success) {
                    alert("保存成功");
                    // 更新本地存储的学生信息
                    studentData = formData;
                    // 关闭编辑窗口并重新显示学生信息
                    document.getElementById('editModal').style.display = 'none';
                    showStudentInfo(studentData);
                } else {
                    alert("保存失败：" + result.message);
                }
            })
            .catch(() => {
                alert("服务器错误");
            })
            .finally(() => {
                // 隐藏加载动画
                hideLoading();
            });
    });

    // 取消编辑
    document.getElementById('cancelBtn').addEventListener('click', () => {
        document.getElementById('editModal').style.display = 'none';
    });

    // 获取学生信息
    let studentData = null;

    function fetchStudentInfo() {
        showLoading();
        fetch('/student/info')
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    studentData = data.data; // 假设返回的数据结构为 { success: true, data: { ...studentInfo } }
                    showStudentInfo(studentData);
                } else {
                    alert("获取学生信息失败：" + data.message);
                }
            })
            .catch(() => {
                alert("服务器错误");
            })
            .finally(() => {
                hideLoading();
            });
    }

    // 页面加载时获取学生信息
    window.onload = fetchStudentInfo;
</script>

</body>
</html>